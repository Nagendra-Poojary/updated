<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Faculty Portal</title>
  <link rel="stylesheet" href="style.css">
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }
    th {
      background: #f4f4f4;
    }
    select {
      padding: 5px;
    }
    .approved {
      background-color: #c8f7c5; /* light green */
    }
    .rejected {
      background-color: #f7c5c5; /* light red */
    }
  </style>
</head>
<body>
  <header>
    <h1>Faculty Portal</h1>
  </header>

  <main>
    <div class="faculty-box">
      <h2><b>Welcome</b></h2>
      <p id="facultyName">Faculty Name</p>

      <h3>Student Leave Requests</h3>
      <table>
        <thead>
          <tr>
            <th>Student</th>
            <th>Reason</th>
            <th>Days</th>
            <th>From</th>
            <th>To</th>
            <th>Applied At</th>
            <th>Decision</th>
          </tr>
        </thead>
        <tbody id="requestsTable"></tbody>
      </table>
    </div>
  </main>

  <script>
    // Show Faculty Name (you can make this dynamic later)
    document.getElementById("facultyName").textContent = "Dr. Sharma"; 
    // The rest of the logic is handled in the main script below.
  </script>
</body>
</html>
<script>
  // Load all requests
  // let requests = JSON.parse(localStorage.getItem("leaveRequests")) || []; // Removed duplicate declaration
  // const tableBody = document.getElementById("requestsTable"); // Already declared above
  // const statusTable = document.getElementById("statusTable"); // Removed duplicate declaration

  // Fill requests table
  if (requests.length === 0) {
    tableBody.innerHTML = `<tr><td colspan="7">No leave requests yet.</td></tr>`;
  } else {
    requests.forEach((req, index) => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${req.user}</td>
        <td>${req.reason}</td>
        <td>${req.days}</td>
        <td>${req.startDate}</td>
        <td>${req.endDate}</td>
        <td>${req.time}</td>
        <td>
          <select data-index="${index}">
            <option value="Pending" ${req.status==="Pending"?"selected":""}>Pending</option>
            <option value="Approved" ${req.status==="Approved"?"selected":""}>Approved</option>
            <option value="Rejected" ${req.status==="Rejected"?"selected":""}>Rejected</option>
          </select>
        </td>
      `;
      tableBody.appendChild(row);
    });
  }

  // Handle faculty submit
  document.getElementById("facultyForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const selects = document.querySelectorAll("select[data-index]");
    selects.forEach(sel => {
      const idx = sel.getAttribute("data-index");
      requests[idx].status = sel.value;
    });

    localStorage.setItem("leaveRequests", JSON.stringify(requests));
    loadStatusTable();
    alert("Decisions saved ✅");
  });

  // Load status table
  function loadStatusTable() {
    statusTable.innerHTML = "";
    requests.forEach(req => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${req.user}</td>
        <td>${req.reason}</td>
        <td>${req.days}</td>
        <td>${req.startDate}</td>
        <td>${req.endDate}</td>
        <td style="font-weight:bold; color:${req.status==='Approved'?'green':req.status==='Rejected'?'red':'black'}">
          ${req.status}
        </td>
      `;
      statusTable.appendChild(row);
    });
  }

  loadStatusTable();
</script>
<form id="facultyForm">
  <table>
    <thead>
      <tr>
        <th>Student</th>
        <th>Reason</th>
        <th>Days</th>
        <th>From</th>
        <th>To</th>
        <th>Applied At</th>
        <th>Decision</th>
      </tr>
    </thead>
    <tbody id="requestsTable"></tbody>
  </table>

  <!-- ✅ Submit button -->
  <button type="submit" 
    style="margin-top:15px; background:#007bff; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">
    Submit
  </button>
</form>
<h3>Student Leave Requests</h3>
<form id="facultyForm">
  <table>
    <thead>
      <tr>
        <th>Select</th>
        <th>Student</th>
        <th>Reason</th>
        <th>Days</th>
        <th>From</th>
        <th>To</th>
        <th>Applied At</th>
        <th>Decision</th>
      </tr>
    </thead>
    <tbody id="requestsTable"></tbody>
  </table>

  <button type="submit" style="margin-top:15px; background:#007bff; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">
    Submit Decisions
  </button>

  <!-- ✅ Delete button -->
  <button type="button" id="deleteFaculty" 
    style="margin-top:15px; background:red; color:white; border:none; padding:8px 15px; border-radius:5px; cursor:pointer;">
    Delete Selected
  </button>
</form>

<h3>Leave Status</h3>
<table>
  <thead>
    <tr>
      <th>Student</th>
      <th>Reason</th>
      <th>Days</th>
      <th>From</th>
      <th>To</th>
      <th>Status</th>
    </tr>
  </thead>
  <tbody id="statusTable"></tbody>
</table>

<script>
  let requests = JSON.parse(localStorage.getItem("leaveRequests")) || [];
  const tableBody = document.getElementById("requestsTable");
  const statusTable = document.getElementById("statusTable");

  function loadRequests() {
    tableBody.innerHTML = "";
    if (requests.length === 0) {
      tableBody.innerHTML = `<tr><td colspan="8">No leave requests yet.</td></tr>`;
    } else {
      requests.forEach((req, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td><input type="checkbox" data-index="${index}"></td>
          <td>${req.user}</td>
          <td>${req.reason}</td>
          <td>${req.days}</td>
          <td>${req.startDate}</td>
          <td>${req.endDate}</td>
          <td>${req.time}</td>
          <td>
            <select data-index="${index}">
              <option value="Pending" ${req.status==="Pending"?"selected":""}>Pending</option>
              <option value="Approved" ${req.status==="Approved"?"selected":""}>Approved</option>
              <option value="Rejected" ${req.status==="Rejected"?"selected":""}>Rejected</option>
            </select>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }
  }

  // ✅ Handle faculty submit
  document.getElementById("facultyForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const selects = document.querySelectorAll("select[data-index]");
    selects.forEach(sel => {
      const idx = sel.getAttribute("data-index");
      requests[idx].status = sel.value;
    });

    localStorage.setItem("leaveRequests", JSON.stringify(requests));
    loadStatusTable();
    alert("Decisions saved ✅");
  });

  // ✅ Delete selected requests
  document.getElementById("deleteFaculty").addEventListener("click", function() {
    const checkboxes = document.querySelectorAll("#requestsTable input[type='checkbox']:checked");

    if (checkboxes.length === 0) {
      alert("Please select at least one request to delete.");
      return;
    }

    const indices = Array.from(checkboxes).map(cb => parseInt(cb.dataset.index));
    requests = requests.filter((_, i) => !indices.includes(i));

    localStorage.setItem("leaveRequests", JSON.stringify(requests));
    loadRequests();
    loadStatusTable();
    alert("Selected requests deleted ✅");
  });

  function loadStatusTable() {
    statusTable.innerHTML = "";
    requests.forEach(req => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${req.user}</td>
        <td>${req.reason}</td>
        <td>${req.days}</td>
        <td>${req.startDate}</td>
        <td>${req.endDate}</td>
        <td style="font-weight:bold; color:${req.status==='Approved'?'green':req.status==='Rejected'?'red':'black'}">
          ${req.status}
        </td>
      `;
      statusTable.appendChild(row);
    });
  }

  loadRequests();
  loadStatusTable();
</script>
